<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DashPro - Device Dashboard</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            background-color: #0f172a;
            color: #f8fafc;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        .navbar {
            background-color: #1e293b;
        }
        .navbar-brand {
            color: #38bdf8 !important;
            font-weight: bold;
        }
        .table {
            background-color: #1e293b;
            color: #f8fafc;
        }
        .table thead {
            background-color: #334155;
        }
        .status-online {
            color: #22c55e;
            font-weight: bold;
        }
        .status-offline {
            color: #ef4444;
            font-weight: bold;
        }
        .flag-dropdown {
            background-color: #1e293b;
            border: 1px solid #334155;
            color: #f8fafc;
            border-radius: 8px;
            padding: 4px 8px;
        }
    </style>
</head>
<body>
    <nav class="navbar navbar-expand-lg px-4">
        <a class="navbar-brand" href="#">DashPro</a>
        <div class="ms-auto">
            <span class="text-secondary">Device Monitoring Dashboard</span>
        </div>
    </nav>

    <div class="container mt-4">
        <h3 class="mb-3">Connected Devices</h3>
        <div class="table-responsive">
            <table class="table table-hover align-middle text-center">
                <thead>
                    <tr>
                        <th>Flags</th>
                        <th>ID</th>
                        <th>Device ID</th>
                        <th>Hostname</th>
                        <th>User</th>
                        <th>OS</th>
                        <th>OS Version</th>
                        <th>Architecture</th>
                        <th>IP</th>
                        <th>MAC</th>
                        <th>CPU (%)</th>
                        <th>Memory (%)</th>
                        <th>Uptime</th>
                        <th>Status</th>
                        <th>Last Seen</th>
                    </tr>
                </thead>
                <tbody>
                    {% if reports %}
                        {% for report in reports %}
                        <tr>
                            <td>
                            <select class="flag-dropdown">
                                <option selected>
                                    {{ report.flag_count or 0 }} â€” {{ report.last_flag_type or 'No Flags' }}
                                </option>
                                <option>Email Scan Detected</option>
                                <option>Malicious File Found</option>
                                <option>Suspicious Process</option>
                            </select>
                            </td>
                            <td>{{ report.id }}</td>
                            <td>{{ report.device_id }}</td>
                            <td>{{ report.hostname }}</td>
                            <td>{{ report.user }}</td>
                            <td>{{ report.os }}</td>
                            <td>{{ report.os_version }}</td>
                            <td>{{ report.architecture }}</td>
                            <td>{{ report.ip }}</td>
                            <td>{{ report.mac }}</td>
                            <td>{{ "%.1f"|format(report.cpu_usage_percent) }}</td>
                            <td>{{ "%.1f"|format(report.memory_usage_percent) }}</td>
                            <td>{{ report.uptime or 'N/A' }}</td>
                            <td>
                                {% if report.status == 'online' %}
                                    <span class="status-online">Online</span>
                                {% else %}
                                    <span class="status-offline">Offline</span>
                                {% endif %}
                            </td>
                            <td class="timestamp">{{ report.last_seen }}</td>

                        </tr>
                        {% endfor %}
                    {% else %}
                        <tr>
                            <td colspan="14" class="text-secondary">No reports found.</td>
                        </tr>
                    {% endif %}
                </tbody>
            </table>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

<script>
    async function refreshTable() {
        try {
            const response = await fetch(window.location.href);
            const html = await response.text();
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');
            const newTableBody = doc.querySelector('tbody');
            document.querySelector('tbody').innerHTML = newTableBody.innerHTML;
        } catch (err) {
            console.error("Auto-refresh failed:", err);
        }
    }

    setInterval(refreshTable, 10000); // every 10 second


    document.querySelectorAll('.timestamp').forEach(el => {
        const utcTime = el.textContent.trim();
        const local = new Date(utcTime).toLocaleString();
        el.textContent = local;
    });
</script>


</body>
</html>
